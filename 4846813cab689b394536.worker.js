!function(r){var n={};function e(o){if(n[o])return n[o].exports;var t=n[o]={i:o,l:!1,exports:{}};return r[o].call(t.exports,t,t.exports,e),t.l=!0,t.exports}e.m=r,e.c=n,e.d=function(r,n,o){e.o(r,n)||Object.defineProperty(r,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(n,"a",n),n},e.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},e.p="/connect4-ai/",e(e.s=0)}([function(r,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e(1);addEventListener("message",function(r){var n=o.a.aiMove(r.data.board,r.data.depth,r.data.aiMark);postMessage({colIx:n})})},function(r,n,e){"use strict";var o=function(){function r(){}return r.dumpBoard=function(r,n,e){for(var o="",t=0;t<n;t++)for(var a=0;a<e;a++)o+=""===r[a][t]?".":r[a][t],a===e-1&&(o+="\n");console.log(o)},r.stringifyBoard=function(r,n,e){for(var o="",t=0;t<n;t++)for(var a=0;a<e;a++)o+=""===r[a][t]?".":r[a][t],a===e-1&&(o+="\n");return o},r.checkForWinner=function(n){var e=r.checkColumnsForWinner(n),o=r.checkRowsForWinner(n),t=r.checkDiagonalForWinner(n),a="";return""!==e?a=e:""!==o?a=o:""!==t?a=t:r.isBoardFull(n)&&(a="tie"),a},r.checkColumnsForWinner=function(r){for(var n=0,e=r;n<e.length;n++)for(var o=e[n],t=0;t<o.length-3;t++)if(o[t]===o[t+1]&&o[t+1]===o[t+2]&&o[t+2]===o[t+3]&&""!==o[t])return o[t];return""},r.checkRowsForWinner=function(r){for(var n=0;n<r.length-3;n++)for(var e=0;e<r[n].length;e++)if(r[n][e]===r[n+1][e]&&r[n+1][e]===r[n+2][e]&&r[n+2][e]===r[n+3][e]&&""!==r[n][e])return r[n][e];return""},r.checkDiagonalForWinner=function(r){for(var n=0;n<r.length-3;n++){for(var e=0;e<r[n].length-3;e++)if(r[n][e]===r[n+1][e+1]&&r[n+1][e+1]===r[n+2][e+2]&&r[n+2][e+2]===r[n+3][e+3]&&""!==r[n][e])return r[n][e];for(e=3;e<r.length;e++)if(r[n][e]===r[n+1][e-1]&&r[n+1][e-1]===r[n+2][e-2]&&r[n+2][e-2]===r[n+3][e-3]&&""!==r[n][e])return r[n][e]}return""},r.isBoardFull=function(r){for(var n=0,e=r;n<e.length;n++)for(var o=0,t=e[n];o<t.length;o++){if(""===t[o])return!1}return!0},r.isValidMove=function(r){for(var n=0,e=r;n<e.length;n++){if(""===e[n])return!0}return!1},r.getNumOccurences=function(r,n){for(var e=0,o=0;o<r.length;o++)r[o]==n&&(e+=1);return e},r.evaluateBoardFor=function(n,e){for(var o=0,t=r.segmentBoard(n),a="",u="X"==(a=""!=e?e:"X")?"O":"X",i=0,f=t;i<f.length;i++){var v=f[i],s=r.getNumOccurences(v,a),l=r.getNumOccurences(v,u);if(0==l&&s>0){if(4==s){o=1e4;break}o+=s*s}if(0==s&&l>0){if(4==l){o=-1e4;break}o-=l*l}}return o},r.evaluateBoardForV2=function(n,e){for(var o=0,t=r.segmentBoard(n),a="",u="X"==(a=""!=e?e:"X")?"O":"X",i=0,f=t;i<f.length;i++){var v=f[i],s=r.getNumOccurences(v,a),l=r.getNumOccurences(v,u);if(0==l&&s>0){if(4==s){o=1e4;break}o+=3==s?50:s*s}if(0==s&&l>0){if(4==l){o=-1e4;break}o-=l*l}}return o},r.segmentBoard=function(n){for(var e=[],o=0,t=r.scanBoard(n);o<t.length;o++){var a=t[o];if(a.length>=4)for(var u=0;u<a.length-3;u++){var i=[];i.push(a[u]),i.push(a[u+1]),i.push(a[u+2]),i.push(a[u+3]),e.push(i)}}return e},r.scanBoard=function(n){for(var e=[],o=0;o<6;o++)e.push(r.scanLine(n,o,0,0,1));for(var t=0;t<7;t++)e.push(r.scanLine(n,0,t,1,0));for(o=0;o<6;o++)e.push(r.scanLine(n,o,0,1,1));for(t=1;t<7;t++)e.push(r.scanLine(n,0,t,1,1));for(o=0;o<6;o++)e.push(r.scanLine(n,o,6,1,-1));for(t=0;t<6;t++)e.push(r.scanLine(n,0,t,1,-1));return e},r.scanLine=function(r,n,e,o,t){var a=[];a.push(r[e][n]);for(var u=n+o,i=e+t;u<6&&u>=0&&i<7&&i>=0;){var f=r[i][u];a.push(f),u+=o,i+=t}return a},r.nextMoves=function(r){for(var n=[],e=0;e<7;e++)r[e].indexOf("")>-1&&n.push(e);return n},r.nextMovesReverse=function(r){for(var n=[],e=6;e>=0;e--)r[e].indexOf("")>-1&&n.push(e);return n},r.nextMovesCenterFirst=function(r){for(var n=[],e=0,o=[3,2,4,1,5,0,6];e<o.length;e++){var t=o[e];r[t].indexOf("")>-1&&n.push(t)}return n},r.isGameOver=function(n){for(var e=0,o=r.segmentBoard(n);e<o.length;e++){var t=o[e];if(t[0]==t[1]&&t[1]==t[2]&&t[2]==t[3]&&""!=t[0])return!0}for(var a=!0,u=0,i=n;u<i.length;u++){i[u].indexOf("")>-1&&(a=!1)}return a},r.deepcopyBoard=function(r){for(var n=[],e=0;e<r.length;e++)n[e]=Array.from(r[e]);return n},r.moveOnBoard=function(n,e,o){for(var t=r.deepcopyBoard(n),a=0;a<6;a++)if(""==t[e][a]){t[e][a]=o;break}return t},r.moveOnBoardWithoutCopy=function(r,n,e){for(var o=0;o<6;o++)if(""==r[n][o]){r[n][o]=e;break}return r},r.unmoveOnBoardWithoutCopy=function(r,n,e){for(var o=6;o>=0;o--)if(r[n][o]==e){r[n][o]="";break}return r},r.minimax=function(n,e,o,t,a,u){var i=0,f=JSON.stringify(n)+e,v=a[f];if(void 0!==v)i=v,u.hitCount++;else if(0==e||r.isGameOver(n))i=r.evaluateBoardFor(n,t);else if(o){i=-1/0;for(var s=0,l=r.nextMoves(n);s<l.length;s++){var c=l[s],h=r.moveOnBoard(n,c,t);(m=r.minimax(h,e-1,!1,t,a,u))>i&&(i=m)}}else{i=1/0;for(var d=0,p=r.nextMoves(n);d<p.length;d++){c=p[d];var m,g="X"==t?"O":"X";h=r.moveOnBoard(n,c,g);(m=r.minimax(h,e-1,!0,t,a,u))<i&&(i=m)}}return v!==i&&(a[f]=i),i},r.minimax_search=function(n,e,o){for(var t=-1/0,a=-1,u={},i={hitCount:0},f=0,v=r.nextMoves(n);f<v.length;f++){var s=v[f];r.moveOnBoardWithoutCopy(n,s,o);var l=r.minimax(n,e-1,!1,o,u,i);r.unmoveOnBoardWithoutCopy(n,s,o),l>t&&(t=l,a=s)}return a},r.sortListByMiddle=function(r){var n=[],e=Math.floor((r.length-1)/2);n.push(r[e]);for(var o=e-1,t=e+1;;){var a=!1,u=!1;if(t<r.length?(n.push(r[t]),t++):u=!0,o>=0?(n.push(r[o]),o--):a=!0,a&&u)break}return n},r.sortListByDistanceToColumnIndex3=function(r){var n=[];return(n=Array.from(r)).sort(function(r,n){return Math.abs(r-3)-Math.abs(n-3)}),n},r.alphabeta=function(n,e,o,t,a,u,i,f,v,s,l){var c=0;if(l.numAlphaBetaCalled++,0==e||r.isGameOver(n)){var h=r.stringifyBoard(n,6,7);!0===s.has(h)?(c=s.get(h),l.hitCount++):(1e4==(c=i(n,u))?c+=e:-1e4==c&&(c-=e),null!==l&&l.numEvals++,s.set(h,c))}else if(a){c=-1/0;for(var d=0,p=f(n);d<p.length;d++){var m=p[d],g=null;g=v?r.moveOnBoard(n,m,u):r.moveOnBoardWithoutCopy(n,m,u);var B=r.alphabeta(g,e-1,o,t,!1,u,i,f,v,s,l);if(!1===v&&r.unmoveOnBoardWithoutCopy(g,m,u),B>c&&(c=B),(o=Math.max(o,c))>=t)break}}else{c=1/0;for(var O=0,b=f(n);O<b.length;O++){m=b[O];var x="X"==u?"O":"X";g=null;g=v?r.moveOnBoard(n,m,x):r.moveOnBoardWithoutCopy(n,m,x);B=r.alphabeta(g,e-1,o,t,!0,u,i,f,v,s,l);if(!1===v&&r.unmoveOnBoardWithoutCopy(g,m,x),B<c&&(c=B),o>=(t=Math.min(t,c)))break}}return c},r.alphabetaSearch=function(n,e,o,t,a,u){for(var i=-1/0,f=-1,v=-1/0,s=new Map,l={numEvals:0,hitCount:0,numAlphaBetaCalled:0},c=a(n),h=0,d=0,p=c;d<p.length;d++){var m=p[d];h+=100/c.length,postMessage({progress:h});var g=null;g=u?r.moveOnBoard(n,m,o):r.moveOnBoardWithoutCopy(n,m,o);var B=r.alphabeta(g,e-1,v,1/0,!1,o,t,a,u,s,l);if(console.log("returnValue:"+B+" value:"+i),!1===u&&r.unmoveOnBoardWithoutCopy(g,m,o),B>i&&(i=B,f=m),(v=Math.max(v,i))>=1/0)break}return console.log("numAlphaBetaCalled:"+l.numAlphaBetaCalled),console.log("numEvals:"+l.numEvals),console.log("hitCount:"+l.hitCount),f},r.aiMove=function(n,e,o){return r.alphabetaSearch(n,e,o,r.evaluateBoardFor,r.nextMovesCenterFirst,!1)},r}();n.a=o}]);
//# sourceMappingURL=4846813cab689b394536.worker.js.map